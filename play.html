<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>IPTV Channel Redirect</title>
  <script>
    async function loadChannels() {
      const res = await fetch("channels.csv");
      const text = await res.text();
      const lines = text.split("\n").filter(l => l.trim() !== "");
      const map = {};
      lines.forEach(line => {
        const [name, link] = line.split(",");
        if(name && link) map[name.trim()] = link.trim();
      });
      return map;
    }

    async function redirectChannel() {
      const channels = await loadChannels();

      // Get channel from query parameter ?c=CHANNEL
      const params = new URLSearchParams(window.location.search);
      const channel = params.get("c");

      if(channel && channels[channel]) {
        // Redirect to the .m3u8 URL
        window.location.href = channels[channel];
      } else {
        // Show list of channels dynamically
        document.write("<h3>Available Channels:</h3>");
        document.write("<ul>");
        for(let c in channels) {
          // Each link includes ?c=CHANNEL
          document.write(`<li><a href="play.html?c=${c}">${c}</a></li>`);
        }
        document.write("</ul>");
      }
    }

    redirectChannel();
  </script>
</head>
<body></body>
</html>
