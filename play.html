<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Channel Redirect</title>
  <script>
    async function loadChannels() {
      const res = await fetch("channels.csv");
      const text = await res.text();
      const lines = text.split("\n").filter(l => l.trim() !== "");
      const map = {};
      lines.forEach(line => {
        const [name, link] = line.split(",");
        if(name && link) map[name.trim()] = link.trim();
      });
      return map;
    }

    async function main() {
      const channels = await loadChannels();

      // Get channel from query string ?c=CHANNEL
      const params = new URLSearchParams(window.location.search);
      const channel = params.get("c");

      if(channel && channels[channel]) {
        // Redirect to the selected channel
        window.location.href = channels[channel];
      } else {
        // Show list of channels if invalid or missing
        document.write("<h3>Channel not found or not selected. Available channels:</h3>");
        document.write("<ul>");
        for(let key in channels) {
          document.write(`<li><a href="?c=${key}">${key}</a></li>`);
        }
        document.write("</ul>");
      }
    }

    main();
  </script>
</head>
<body></body>
</html>
